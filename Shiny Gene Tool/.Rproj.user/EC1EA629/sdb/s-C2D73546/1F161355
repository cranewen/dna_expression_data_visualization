{
    "collab_server" : "",
    "contents" : "library(RMySQL)\nlibrary(DBI)\nlibrary(dplyr)\nlibrary(pool)\nlibrary(reshape2)\nlibrary(plotly)\n\nmysqldbpool <- dbPool(\n  RMySQL::MySQL(),\n  dbname = \"b_dna\",\n  host = \"172.20.203.118\",\n  username = \"ironwood\",\n  password = \"irtest\"\n)\n\ngene <- data.frame(mysqldbpool %>% tbl(\"gene\"))\ncondition <- data.frame(mysqldbpool %>% tbl(\"condition\"))\nexperiment <- data.frame(mysqldbpool %>% tbl(\"experiment\"))\ngene_expression <- data.frame(mysqldbpool %>% tbl(\"gene_expression\"))\n\n\n#################################################\nexperiments <- experiment %>% inner_join(gene_expression, by = c('id' = 'experiment_id' )) %>% \n  inner_join(gene, by = c('gene_id' = 'id')) %>% \n  filter(name == 'NOS3')  %>% distinct(description)\n\n\nconditions <- condition %>% inner_join(gene_expression, by = c('id' = 'condition_id')) %>% \n  inner_join(experiment, by = c('experiment_id' = 'id')) %>% \n  filter(description %in% '') %>% distinct(name)\n\nl <- list()\nl1 <- list(\"a\",\"b\",\"c\")\nl2 <- list(c(1,2,3), c(2,3,4), c(3,4,5))\nl <- apply(l1, 1, function(x){x = l2})\n\nexperiments_desc <- list('DB2 mice Gastic sample 35-plex  1-29-16', 'mdx mice Gastic sample 35-plex  3-18-16')\n\ngetList_desc_conditions <- function(descriptions){\n  # desc_cond_list <- list()\n  conditions_list <- list()\n  for(i in 1:length(descriptions)){\n    conditions <- condition %>% inner_join(gene_expression, by = c('id' = 'condition_id')) %>% \n      inner_join(gene, by = c('gene_id'= 'id')) %>%\n      inner_join(experiment, by = c('experiment_id' = 'id')) %>% \n      filter(description == descriptions[[i]] & name.y == 'DCN') %>% distinct(name.x)\n    conditions_list[[i]] = conditions$name.x\n  }\n  desc_cond_list <- rbind(descriptions, conditions_list)\n  newlist <- apply(desc_cond_list, 2, function(x){paste(x$descriptions,\"-\",x$conditions_list)})\n  return(desc_cond_list)\n}\n\nlistTest <- unlist(getList_desc_conditions(experiments_desc))\nsubText <- '1701 Dahl rat kidney sample 39-plex  9-3-15 - HS'\nnewSub <- sub(\".*- \",\"\",subText)\n# subTextList <- list('1701 Dahl rat kidney sample 39-plex  9-3-15 - HS', 'AngII rat brain 50-plex (norm to Polr2a&Ppib)  3-31-17 - HFHF/ANGII/41-2272/22 DAYS')\n# newSubList <- sapply(subTextList, function(x){sub(\".*- \",\"\",x)})\n\n# get barchart data from 1 gene, 1 experiment and multiple conditions\ngetBarChartDat <- function(experiment, conditions){\n  dat <- gene_expression %>% inner_join(gene, by = c(\"gene_id\" = \"id\")) %>% \n    inner_join(condition, by = c(\"condition_id\" = \"id\")) %>% \n    inner_join(experiment, by = c(\"experiment_id\" = \"id\")) %>% \n    filter(description == experiment & \n             name.y %in% conditions & name.x == 'DCN') %>% \n    select(expression, name.y, description)\n  colnames(dat) <- c('expression', 'condition', 'description')\n  dat <- aggregate(expression ~ condition + description, data = dat, FUN = 'mean')\n  return(dat)\n}\n\nbarCharListDat <- getList_desc_conditions(experiments_desc)\nbarCharDatList <- list()\nfor(i in 1:length(dim(barCharListDat))){\n  barCharDatList[[i]] <- getBarChartDat(c(barCharListDat[,i]$descriptions), c(barCharListDat[,i]$conditions_list))\n}\n\n\ndat1 <- gene_expression %>% inner_join(gene, by = c(\"gene_id\" = \"id\")) %>% \n  inner_join(condition, by = c(\"condition_id\" = \"id\")) %>% \n  inner_join(experiment, by = c(\"experiment_id\" = \"id\")) %>% \n  filter(description == \"mdx mice Gastic sample 35-plex  3-18-16\" & \n           name.y %in% c(\"NORMAL\", \"MDX\", \"MDX/1973 (3)\", \"MDX/1973 (1)\", \"MDX/1973(0.3)\", \"MDX/TADANAFIL (5)\") & name.x == 'DCN') %>% \n  select(expression, name.y, description)\n  colnames(dat1) <- c('expression', 'condition', 'description')\n  \n\n\n#################################\n#name.x is gene, name.y is condition\nbarChatTestDat <- gene_expression %>% inner_join(gene, by = c(\"gene_id\" = \"id\")) %>% \n  inner_join(condition, by = c(\"condition_id\" = \"id\")) %>% \n  inner_join(experiment, by = c(\"experiment_id\" = \"id\")) %>% \n  filter(description %in% c('DB2 mice Gastic sample 35-plex  1-29-16', 'mdx mice Gastic sample 35-plex  3-18-16') & \n           name.y %in% c('NORMAL', 'MDX', 'MDX/1973 (3)') & name.x == 'DCN') %>% \n  select(expression, name.y, description)\ncolnames(barChatTestDat) <- c('expression', 'condition', 'description')\n\ndcastBarChatTestDat <- dcast(barChatTestDat, condition ~ description, value.var = 'expression')\nbarChartTestDat1 <- aggregate(expression ~ condition + description, data = barChatTestDat, FUN = 'mean')\nplot_ly(data = barChartTestDat1, x = ~description, y = ~expression, type = 'bar')\n\n\n\nconditionsTest <- conditions <- condition %>% inner_join(gene_expression, by = c('id' = 'condition_id')) %>% \n  inner_join(gene, by = c('gene_id'= 'id')) %>%\n  inner_join(experiment, by = c('experiment_id' = 'id')) %>% \n  filter(description == 'DB2 mice Gastic sample 35-plex  1-29-16' & name.y == 'DCN') %>% distinct(name.x)\n###############################################################################################################################\n\nl1 <- list('a' = 1)\nl2 <- list('a' = 2)\nl3 <- list('a' = 3)\nl4 <- list('b' = 4)\nl123 <- rbind(l1,l2,l3)\n\ndesc1 <- \"abc\"\nlist1 <- list(\"abc - 1\", \"abcd - 1\", \"abd -1\", \"abc\")\nfor(l in list1){\n  if(desc1 %in% l){\n    print(\"true\")\n  }\n}\n\n\n\ntheList <- c(\"mdx mice Gastic sample 35-plex  3-18-16 <--> MDX\",\n                \"mdx mice Gastic sample 35-plex  3-18-16 <--> NORMAL\",\n                \"mdx mice Gastic sample 35-plex  3-18-16 <--> MDX/1973(0.3)\",\n                \"mdx mice Gastic sample 35-plex  3-18-16 <--> MDX/1973 (1)\",\n                \"mdx mice Gastic sample 35-plex  3-18-16 <--> MDX/1973 (3)\",\n                \"mdx  mice diaphragm sample 35-plex  3-18-16 <--> MDX\",\n                \"mdx  mice diaphragm sample 35-plex  3-18-16 <--> MDX/1973 (3)\",\n                \"mdx  mice diaphragm sample 35-plex  3-18-16 <--> MDX/1973(0.3)\",\n                \"mdx  mice diaphragm sample 35-plex  3-18-16 <--> MDX/TADANAFIL (5)\",\n                \"mdx mice Gastic sample 35-plex  3-18-16 <--> MDX/TADANAFIL (5)\")\n\n# theList is input$condition\nl1 <- unlist(lapply(theList, function(x){sub(\"( <--> .*)\",\"\", x)})) \nl2 <- unlist(lapply(theList, function(x){sub(\"(.*?<--> )\",\"\", x)}))\nl3 <- data.frame(l1,l2)\ntheDescs <- c('mdx mice Gastic sample 35-plex  3-18-16', 'mdx  mice diaphragm sample 35-plex  3-18-16')\nfor(d in theDescs){\n  for(i in length(l1)){\n    if(d == l1[i]){\n      \n    }\n  }\n}\n# Get the conditions list correspond to the experiment and gene\ngetConditionsList <- function(experiment) {\n  conditionsList <- list()\n  for(i in 1:length(l1)){\n    if(experiment == l1[i]){\n      conditionsList[i] <- l2[i]\n    }\n  }\n  conditionsList <- Filter(Negate(is.null), conditionsList)\n  return(conditionsList)\n}\ngetlisttest <- getConditionsList('mdx mice Gastic sample 35-plex  3-18-16')\n\n\ndat <- gene_expression %>% inner_join(gene, by = c('gene_id' = 'id')) %>% \n  inner_join(experiment, by = c('experiment_id' = 'id')) %>% \n  inner_join(condition, by = c('condition_id' = 'id')) %>% \n  filter(description == experiments[i] & name.y %in% conditions[[i]] & name.x == input$gene) %>%\n  select(expression, name.y)\ncolnames(dat) <- c('expression', 'condition')\n",
    "created" : 1503327729551.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "3358618742",
    "id" : "1F161355",
    "lastKnownWriteTime" : 1503516270,
    "last_content_update" : 1503516270142,
    "path" : "C:/Users/ywen/OneDrive - Ironwood Pharmaceuticals/B_DNA Project/B_DNA_Webapp/Shiny Gene Tool/test.R",
    "project_path" : "test.R",
    "properties" : {
        "tempName" : "Untitled1"
    },
    "relative_order" : 8,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_source"
}